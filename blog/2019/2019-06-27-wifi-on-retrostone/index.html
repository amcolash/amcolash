<!DOCTYPE html><html><head><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-114681426-1"></script><script>
            window.dataLayer = window.dataLayer || [];
            function gtag() { dataLayer.push(arguments); }
            gtag(&#x27;js&#x27;, new Date());

            gtag(&#x27;config&#x27;, &#x27;UA-114681426-1&#x27;);</script><link rel="preconnect" href="https://fonts.gstatic.com"/><link rel="stylesheet" data-href="https://fonts.googleapis.com/css2?family=Rubik&amp;display=swap"/><style>
            body.dark-mode { background: #222; color: #eee; }
            body.light-mode { background: #eee; color: #222; }
            .light-mode :focus, .dark-mode .resume :focus { outline: 3px solid #222; }
            .dark-mode :focus { outline: 3px solid #eee; }
            * { transition: background 0.25s; }
            a { transition: color 0.25s; }
            .post img, .project img { max-width: 100%; }
          </style><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/css/f4713d82fa08c400fc7c.css" as="style"/><link rel="stylesheet" href="/_next/static/css/f4713d82fa08c400fc7c.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a40ef1678bae11e696dba45124eadd70.js"></script><script src="/_next/static/chunks/webpack-325f58eb379b5ed68068.js" defer=""></script><script src="/_next/static/chunks/main-9c64df40709a4c7ee8ba.js" defer=""></script><script src="/_next/static/chunks/framework-0185cf57659ff2d2874b.js" defer=""></script><script src="/_next/static/chunks/pages/_app-fcc9a129a32b1c8bae5f.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-6b20f5673ee9f46938b3.js" defer=""></script><script src="/_next/static/mU3A4e98PvIASSuIr1LG3/_buildManifest.js" defer=""></script><script src="/_next/static/mU3A4e98PvIASSuIr1LG3/_ssgManifest.js" defer=""></script><style data-href="https://fonts.googleapis.com/css2?family=Rubik&display=swap">@font-face{font-family:'Rubik';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/rubik/v14/iJWZBXyIfDnIV5PNhY1KTN7Z-Yh-B4i1Uw.woff) format('woff')}@font-face{font-family:'Rubik';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/rubik/v14/iJWZBXyIfDnIV5PNhY1KTN7Z-Yh-B4iFWkUzdYPFkZVOA6w.woff) format('woff');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Rubik';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/rubik/v14/iJWZBXyIfDnIV5PNhY1KTN7Z-Yh-B4iFU0UzdYPFkZVOA6w.woff) format('woff');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Rubik';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/rubik/v14/iJWZBXyIfDnIV5PNhY1KTN7Z-Yh-B4iFVUUzdYPFkZVOA6w.woff) format('woff');unicode-range:U+0590-05FF,U+20AA,U+25CC,U+FB1D-FB4F}@font-face{font-family:'Rubik';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/rubik/v14/iJWZBXyIfDnIV5PNhY1KTN7Z-Yh-B4iFWUUzdYPFkZVOA6w.woff) format('woff');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Rubik';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/rubik/v14/iJWZBXyIfDnIV5PNhY1KTN7Z-Yh-B4iFV0UzdYPFkZVO.woff) format('woff');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body style="margin:0;font-family:Rubik, sans-serif;font-size:1.25rem;overflow-x:hidden"><script src="/noflash.js"></script><div id="__next"><div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"Setting Up WiFi On a RetroStone","date":"2019-06-28T02:15:56.000Z","slug":"2019/2019-06-27-wifi-on-retrostone","content":"\u003cp\u003eI recently got a really cool little retro gaming console called a \u003ca href=\"https://www.8bcraft.com/product/retrostone/\"\u003eRetroStone\u003c/a\u003e which allows me to run all kinds of retro emulators and re-live my childhood on the go. It is a pretty slick piece of tech with a completely custom-built PCB and case. A comprable DIY raspberry pi zero build costs about the same but with a single core instead of the RetroStone's quad core H3 processor. Emulating N64 and PS1 is a breeze and works smoothly for almost all but the most demanding games out there!\u003c/p\u003e\n\u003cp\u003eNow that I had such a cool piece of tech to work on, it was time to get some games on it. It has a built in ethernet port so I ssh'ed in and went to town. Later that night I realized I had forgotten Zelda: Links Awakening a game I really loved playing as a kid had been missed when I copied some games I owned over. It would have been great to do it without powering off and taking out the SD and without needing cables. Luckily I had a $3 wifi dongle sitting around.\u003c/p\u003e\n\u003ch2\u003eThe Issue\u003c/h2\u003e\n\u003cp\u003eLittle did I know that getting wifi working on this little device would be quite a headache (and it still isn't fully working properly).\u003c/p\u003e\n\u003cp\u003eI started by figuring out what wifi dongle I had. It turns out I had a variant of the 8812EU chip, which \u003cem\u003eSHOULD\u003c/em\u003e be supported out of the box on most linux kernels going back some time. Of course, plug and play never quite seems to work on any SBC.\u003c/p\u003e\n\u003cp\u003eI started by installing headers for my kernel (3.4.113-sun8i a very old kernel at the time of writing) and trying to compile various versions of drivers I found for the 8812EU. These efforts didn't get me too far and after fighting with trying to get things working I threw in the towel on this front. It was a lot of work and there must be support already since it looked like the usb device was being picked up by \u003ccode\u003elsusb\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eNext, I decided to read through the logs from \u003ccode\u003edmesg\u003c/code\u003e and here things got more interesting. Here is what happened after I plugged the device in\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e[  843.112752] ehci_irq: highspeed device connect\n[  843.380223] usb 3-1: new high-speed USB device number 2 using sunxi-ehci\n[  843.532354] usb 3-1: New USB device found, idVendor=0bda, idProduct=8179\n[  843.532394] usb 3-1: New USB device strings: Mfr=1, Product=2, SerialNumber=3\n[  843.532424] usb 3-1: Product: 802.11n WLAN NIC\n[  843.532447] usb 3-1: Manufacturer: Realtek\n[  843.599057] RTL871X: module init start\n[  843.599093] RTL871X: rtl8188eu v4.3.0.6_12167.20140828\n[  843.599115] RTL871X: build time: Feb  9 2019 20:17:07\n[  843.599146] ERR: script_get_item wifi_usbc_id failed\n[  843.599166] RTL871X: module init ret=-1\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eNotice the 2nd last line has the error \u003ccode\u003eERR: script_get_item wifi_usbc_id failed\u003c/code\u003e. A quick stop at google and I started finding interesting results on the web. It looks like there is an improperly configured setup in the \u003ca href=\"http://www.retrorangepi.org/\"\u003eRetrOrangePi\u003c/a\u003e (similar to RetroPie but for OrangePi boards) image that I had flashed.\u003c/p\u003e\n\u003ch2\u003eThe Fix\u003c/h2\u003e\n\u003cp\u003eThe fix is actually pretty simple to work through. You just have to modify the \u003ccode\u003e.fex\u003c/code\u003e configuration that is loaded on the boot of \u003ca href=\"https://www.armbian.com/\"\u003earmbian\u003c/a\u003e (the underlying OS used with allwinner chips and RetrOrangePi).\u003c/p\u003e\n\u003cp\u003eStart the armbian configuration utility using the command \u003ccode\u003esudo armbian-config\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eSelect system from the menu, then choose Fexedit from the submenu. This will open a text editor with the boot configuration of the device. Around 75% of the way through the file for me, there was a chunk that started with \u003ccode\u003e[wifi_para]\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eI changed the line \u003ccode\u003ewifi_usbc_id =\u003c/code\u003e to \u003ccode\u003ewifi_usbc_id = 1\u003c/code\u003e based off of a post \u003ca href=\"http://4pda.ru/forum/lofiversion/index.php?t750921-1740.html\"\u003ehere\u003c/a\u003e and magically after a reboot the network device now showed up with \u003ccode\u003esudo ifconfig\u003c/code\u003e. As an odd side effect, it seems that 2 network devices showed up: \u003ccode\u003ewlan1\u003c/code\u003e as well as \u003ccode\u003ewlan3\u003c/code\u003e. I am not sure why both are there, but it seems that it has something to do with \u003ccode\u003enetwork-manager\u003c/code\u003e being installed. After uninstalling, one of the devices disappeared, but there were still quirks so I didn't mention that part.\u003c/p\u003e\n\u003cp\u003eThe final step was to configure wifi on the device. This is pretty simple using the built in command \u003ccode\u003esudo nmtui-connect\u003c/code\u003e. I connected to wifi with \u003ccode\u003ewlan3\u003c/code\u003e since this seemed to work out better than \u003ccode\u003ewlan1\u003c/code\u003e. After connected to wifi things seemed to be working - that is until I tried to ssh over wifi when I unplugged the ethernet cable while it was turned on. For some reason or another, it seems that having both network interfaces enabled at the same time confuses something (though I have never had an issue on other similar linux devices). My solution to this problem is to choose a method of connection when the device is off and then to only switch from wifi/ethernet after a reboot.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eUPDATE 06/30/2019\u003c/strong\u003e:\nI ended up editing up \u003ccode\u003e/etc/network/interfaces\u003c/code\u003e to try and get things working better. I was able to turn off power management on the wifi device which really helped the reliability of the connection. (Just uncommented from the existing file)\u003c/p\u003e\n\u003ch2\u003eWrapping Up\u003c/h2\u003e\n\u003cp\u003eLuckily things were not too complicated in the end to get working, but what a pain that was. Working with newer versions of linux kernels I would assume would solve a lot of the issues seen here - someday I hope I can get a mainline kernel onto this thing to make things work out of the box. Until then, I have this workaround which works well enough for a once in a while wifi connection!\u003c/p\u003e\n"}},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["2019","2019-06-27-wifi-on-retrostone"]},"buildId":"mU3A4e98PvIASSuIr1LG3","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>